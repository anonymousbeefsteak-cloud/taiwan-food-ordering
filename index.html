<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>å°ç£å°åƒåº— - LINE å¿«é€Ÿè¨‚é¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            background-color: #f7fafc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        input, textarea, select {
            -webkit-user-select: text;
            user-select: text;
        }
        .clickable-btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="text-center">
                <div class="text-6xl mb-4">â³</div>
                <p class="text-gray-600">è¼‰å…¥è¨‚é¤åŠŸèƒ½ä¸­...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useCallback, useEffect, useMemo } = React;

        // é…ç½® - ä½¿ç”¨æ‚¨çš„å¯¦éš›è³‡æ–™
        const LIFF_ID = '2008316489-6nMjb0KX';
        const API_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxR1gzQgV1jq8DUhYX8EY0EmA6i2PBnjo_IZJUuwRgj7Ggjgro8Mdbnic7ZdhIIc2B1/exec';
        const DELIVERY_FEE = 30;

        // å®Œæ•´èœå–®è³‡æ–™
        const menuItems = [
            { name: 'æ»·è‚‰é£¯', price: 35, icon: 'ğŸš', status: 'ä¾›æ‡‰ä¸­' },
            { name: 'é›è‚‰é£¯', price: 40, icon: 'ğŸ—', status: 'ä¾›æ‡‰ä¸­' },
            { name: 'èšµä»”ç…', price: 65, icon: 'ğŸ³', status: 'ä¾›æ‡‰ä¸­' },
            { name: 'å¤§è…¸éºµç·š', price: 50, icon: 'ğŸœ', status: 'ä¾›æ‡‰ä¸­' },
            { name: 'çç å¥¶èŒ¶', price: 45, icon: 'ğŸ¥¤', status: 'ä¾›æ‡‰ä¸­' }
        ];

        // åŠ è¼‰å‹•ç•«çµ„ä»¶
        const LoadingSpinner = () => {
            return React.createElement('svg', {
                className: 'animate-spin -ml-1 mr-3 h-5 w-5',
                xmlns: 'http://www.w3.org/2000/svg',
                fill: 'none',
                viewBox: '0 0 24 24'
            },
                React.createElement('circle', {
                    className: 'opacity-25',
                    cx: '12',
                    cy: '12',
                    r: '10',
                    stroke: 'currentColor',
                    strokeWidth: '4'
                }),
                React.createElement('path', {
                    className: 'opacity-75',
                    fill: 'currentColor',
                    d: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'
                })
            );
        };

        // èœå“é …ç›®çµ„ä»¶
        const MenuItem = ({ item, cartQuantity, onUpdateCart }) => {
            return React.createElement('div', { 
                className: 'bg-white rounded-lg p-4 border border-gray-200 shadow-sm mb-3' 
            },
                React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                    React.createElement('div', null,
                        React.createElement('h3', { className: 'font-bold text-gray-800 text-sm' }, 
                            `${item.icon} ${item.name}`
                        ),
                        React.createElement('p', { className: 'text-green-600 font-bold text-sm' }, 
                            `$${item.price}`
                        )
                    ),
                    React.createElement('span', { 
                        className: 'text-xs px-2 py-1 rounded-full bg-green-100 text-green-800'
                    }, item.status)
                ),
                
                React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('button', {
                        onClick: () => onUpdateCart(item.name, -1),
                        disabled: cartQuantity === 0,
                        className: `w-8 h-8 rounded-full flex items-center justify-center text-white font-bold clickable-btn ${
                            cartQuantity === 0 ? 'bg-gray-400 cursor-not-allowed' : 'bg-red-500 hover:bg-red-600'
                        }`
                    }, '-'),
                    
                    React.createElement('span', { 
                        className: 'min-w-8 text-center font-bold text-lg'
                    }, cartQuantity),
                    
                    React.createElement('button', {
                        onClick: () => onUpdateCart(item.name, 1),
                        className: 'w-8 h-8 rounded-full bg-green-500 text-white font-bold hover:bg-green-600 clickable-btn'
                    }, '+')
                )
            );
        };

        // æˆåŠŸé é¢
        const SuccessPage = ({ orderData, onNewOrder }) => {
            const formatDisplayTime = (timestamp) => new Date(timestamp).toLocaleString('zh-TW');
            
            return React.createElement('div', { className: 'text-center p-5' },
                React.createElement('div', { className: 'text-6xl mb-5' }, 'âœ…'),
                React.createElement('h3', { className: 'text-2xl font-bold text-green-600 mb-4' }, 'è¨‚å–®æäº¤æˆåŠŸï¼'),
                React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg my-5 text-left border' },
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'è¨‚å–®ç·¨è™Ÿï¼š'),
                        React.createElement('span', { className: 'font-mono' }, orderData.orderId || 'TEST_' + Date.now())
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'é¡§å®¢å§“åï¼š'),
                        React.createElement('span', null, orderData.customerName)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'è¯çµ¡é›»è©±ï¼š'),
                        React.createElement('span', null, orderData.customerPhone)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'æœ€çµ‚ç¸½é‡‘é¡ï¼š'),
                        '$',
                        React.createElement('span', { className: 'text-green-600 font-bold' }, orderData.totalAmount)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'å–é¤æ™‚é–“ï¼š'),
                        React.createElement('span', null, formatDisplayTime(orderData.pickupTime))
                    ),
                    orderData.deliveryAddress && React.createElement('p', null, 
                        React.createElement('strong', null, 'å¤–é€åœ°å€ï¼š'),
                        React.createElement('span', null, orderData.deliveryAddress)
                    ),
                    orderData.notes && React.createElement('p', null, 
                        React.createElement('strong', null, 'å‚™è¨»ï¼š'),
                        React.createElement('span', null, orderData.notes)
                    )
                ),
                React.createElement('button', {
                    onClick: onNewOrder,
                    className: 'bg-green-600 text-white border-none py-3 px-8 rounded-md cursor-pointer text-base mt-5 hover:bg-green-700 clickable-btn'
                }, 'ğŸ“ å†è¨‚ä¸€å–®')
            );
        };

        // ä¸»è¨‚é¤çµ„ä»¶
        const OrderPage = () => {
            const [cart, setCart] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [orderSubmitted, setOrderSubmitted] = useState(false);
            const [submittedOrder, setSubmittedOrder] = useState(null);
            const [customerName, setCustomerName] = useState('');
            const [customerPhone, setCustomerPhone] = useState('');
            const [pickupDate, setPickupDate] = useState('');
            const [pickupTime, setPickupTime] = useState('');
            const [deliveryAddress, setDeliveryAddress] = useState('');
            const [notes, setNotes] = useState('');

            // åˆå§‹åŒ–æ—¥æœŸæ™‚é–“
            useEffect(() => {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                setPickupDate(today);
                
                now.setMinutes(now.getMinutes() + 30);
                const minutes = Math.ceil(now.getMinutes() / 30) * 30;
                now.setMinutes(minutes);
                const timeString = now.toTimeString().slice(0, 5);
                setPickupTime(timeString);
            }, []);

            // è¨ˆç®—é‡‘é¡
            const { subtotal, deliveryFee, totalAmount } = useMemo(() => {
                const sub = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const fee = deliveryAddress.trim() ? DELIVERY_FEE : 0;
                return { subtotal: sub, deliveryFee: fee, totalAmount: sub + fee };
            }, [cart, deliveryAddress]);

            // æ›´æ–°è³¼ç‰©è»Š
            const updateCart = (itemName, change) => {
                setCart(prevCart => {
                    const existingIndex = prevCart.findIndex(item => item.name === itemName);
                    
                    if (existingIndex === -1) {
                        if (change > 0) {
                            const menuItem = menuItems.find(item => item.name === itemName);
                            return menuItem ? [...prevCart, { ...menuItem, quantity: 1 }] : prevCart;
                        }
                        return prevCart;
                    }
                    
                    const newCart = [...prevCart];
                    const currentQuantity = newCart[existingIndex].quantity;
                    const newQuantity = currentQuantity + change;
                    
                    if (newQuantity <= 0) {
                        newCart.splice(existingIndex, 1);
                    } else {
                        newCart[existingIndex] = { ...newCart[existingIndex], quantity: newQuantity };
                    }
                    
                    return newCart;
                });
            };

            // ç²å–å•†å“æ•¸é‡
            const getItemQuantity = (itemName) => {
                const item = cart.find(item => item.name === itemName);
                return item ? item.quantity : 0;
            };

            // æ¸…ç©ºè³¼ç‰©è»Š
            const clearCart = () => {
                if (window.confirm('ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šå—ï¼Ÿ')) {
                    setCart([]);
                }
            };

            // ç”Ÿæˆæ—¥æœŸé¸é …
            const getDateOptions = () => {
                const dates = [];
                const today = new Date();
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    dates.push({
                        value: date.toISOString().split('T')[0],
                        label: date.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'short' })
                    });
                }
                
                return dates;
            };

            // ç”Ÿæˆæ™‚é–“é¸é …
            const getTimeOptions = () => {
                const times = [];
                for (let hour = 10; hour <= 21; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        times.push(`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`);
                    }
                }
                return times;
            };

            // ç²å–å®Œæ•´å–é¤æ™‚é–“
            const getFullPickupTime = () => {
                return pickupDate && pickupTime ? `${pickupDate}T${pickupTime}` : '';
            };

            // è¡¨å–®é©—è­‰
            const validateForm = () => {
                if (!customerName.trim()) {
                    alert('è«‹å¡«å¯«å§“å');
                    return false;
                }
                if (!/^09\d{8}$/.test(customerPhone)) {
                    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„10ä½æ‰‹æ©Ÿè™Ÿç¢¼ (09é–‹é ­)');
                    return false;
                }
                if (!pickupDate || !pickupTime) {
                    alert('è«‹é¸æ“‡å–é¤æ—¥æœŸå’Œæ™‚é–“');
                    return false;
                }
                if (cart.length === 0) {
                    alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é¤é»');
                    return false;
                }
                return true;
            };

            // æäº¤è¨‚å–®
            const handleSubmit = async () => {
                if (!validateForm()) return;
                
                setIsLoading(true);
                try {
                    // æ¨¡æ“¬ API å‘¼å«å»¶é²
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const orderData = {
                        customerName,
                        customerPhone,
                        items: cart,
                        pickupTime: getFullPickupTime(),
                        deliveryAddress,
                        notes,
                        totalAmount
                    };
                    
                    // è¨­å®šæäº¤çš„è¨‚å–®è³‡æ–™
                    setSubmittedOrder({
                        ...orderData,
                        orderId: 'ORD_' + Date.now()
                    });
                    setOrderSubmitted(true);
                    
                } catch (error) {
                    alert('è¨‚å–®æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                } finally {
                    setIsLoading(false);
                }
            };

            // æ–°è¨‚å–®
            const handleNewOrder = () => {
                setOrderSubmitted(false);
                setSubmittedOrder(null);
                setCart([]);
                setCustomerName('');
                setCustomerPhone('');
                setDeliveryAddress('');
                setNotes('');
            };

            const dateOptions = getDateOptions();
            const timeOptions = getTimeOptions();

            // å¦‚æœè¨‚å–®å·²æäº¤ï¼Œé¡¯ç¤ºæˆåŠŸé é¢
            if (orderSubmitted && submittedOrder) {
                return React.createElement(SuccessPage, {
                    orderData: submittedOrder,
                    onNewOrder: handleNewOrder
                });
            }

            return React.createElement('div', null,
                // ç‹€æ…‹æ©«å¹…
                React.createElement('div', { 
                    className: 'p-3 rounded-lg text-sm text-center bg-blue-100 border border-blue-400 text-blue-800 mb-4'
                }, 'ğŸ”„ LINE åŠŸèƒ½åˆå§‹åŒ–ä¸­...'),
                
                // è¡¨å–®å€åŸŸ
                React.createElement('div', { className: 'space-y-4' },
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'å§“å *'),
                        React.createElement('input', {
                            type: 'text',
                            value: customerName,
                            onChange: (e) => setCustomerName(e.target.value),
                            placeholder: 'è«‹è¼¸å…¥æ‚¨çš„å§“å',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        })
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'æ‰‹æ©Ÿè™Ÿç¢¼ *'),
                        React.createElement('input', {
                            type: 'tel',
                            value: customerPhone,
                            onChange: (e) => setCustomerPhone(e.target.value),
                            placeholder: '0936123456',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        })
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'å–é¤æ—¥æœŸ *'),
                        React.createElement('select', {
                            value: pickupDate,
                            onChange: (e) => setPickupDate(e.target.value),
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        },
                            React.createElement('option', { value: '' }, 'è«‹é¸æ“‡å–é¤æ—¥æœŸ'),
                            dateOptions.map(date => 
                                React.createElement('option', { key: date.value, value: date.value }, date.label)
                            )
                        )
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'å–é¤æ™‚é–“ *'),
                        React.createElement('select', {
                            value: pickupTime,
                            onChange: (e) => setPickupTime(e.target.value),
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        },
                            React.createElement('option', { value: '' }, 'è«‹é¸æ“‡å–é¤æ™‚é–“'),
                            timeOptions.map(time => 
                                React.createElement('option', { key: time, value: time }, time)
                            )
                        )
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'å¤–é€åœ°é» (é¸å¡«)'),
                        React.createElement('input', {
                            type: 'text',
                            value: deliveryAddress,
                            onChange: (e) => setDeliveryAddress(e.target.value),
                            placeholder: 'å¦‚éœ€å¤–é€è«‹å¡«å¯«åœ°å€',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        })
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'å‚™è¨» (é¸å¡«)'),
                        React.createElement('textarea', {
                            value: notes,
                            onChange: (e) => setNotes(e.target.value),
                            rows: 2,
                            placeholder: 'ä¾‹å¦‚ï¼šä¸è¦é¦™èœã€åŠ è¾£ç­‰',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        })
                    )
                ),
                
                // èœå–®å€åŸŸ
                React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4' },
                    React.createElement('h2', { className: 'text-center text-lg font-bold text-gray-800 mb-4' }, 'ğŸ“ é¸æ“‡é¤é»'),
                    React.createElement('div', { className: 'space-y-3' },
                        menuItems.map(item => 
                            React.createElement(MenuItem, {
                                key: item.name,
                                item: item,
                                cartQuantity: getItemQuantity(item.name),
                                onUpdateCart: updateCart
                            })
                        )
                    )
                ),

                // è³¼ç‰©è»Š
                cart.length > 0 && React.createElement('div', { className: 'bg-yellow-50 p-4 rounded-lg border border-yellow-200 mt-4' },
                    React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-800' }, 
                            `ğŸ›’ è¨‚å–®æ˜ç´° (${cart.reduce((sum, item) => sum + item.quantity, 0)} é …)`
                        ),
                        React.createElement('button', {
                            onClick: clearCart,
                            className: 'text-xs bg-red-100 text-red-600 hover:bg-red-500 hover:text-white font-semibold py-1 px-3 rounded-full clickable-btn'
                        }, 'ğŸ—‘ï¸ æ¸…ç©º')
                    ),
                    
                    React.createElement('div', { className: 'space-y-2' },
                        cart.map(item => 
                            React.createElement('div', { 
                                key: item.name,
                                className: 'flex justify-between items-center py-2 border-b border-gray-200'
                            },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'font-bold text-gray-800 text-sm' }, 
                                        `${item.icon} ${item.name}`
                                    ),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 
                                        `$${item.price} x ${item.quantity}`
                                    )
                                ),
                                React.createElement('p', { className: 'font-bold text-green-600' }, 
                                    `$${item.price * item.quantity}`
                                )
                            )
                        )
                    )
                ),
                
                // é‡‘é¡ç¸½çµ
                cart.length > 0 && React.createElement('div', { className: 'bg-green-50 p-4 rounded-lg border border-green-200 space-y-2 mt-4' },
                    React.createElement('div', { className: 'flex justify-between text-sm text-gray-600' },
                        React.createElement('span', null, 'é¤é»ç¸½è¨ˆ:'),
                        React.createElement('span', null, `$${subtotal}`)
                    ),
                    deliveryFee > 0 && React.createElement('div', { className: 'flex justify-between text-sm text-gray-600' },
                        React.createElement('span', null, 'å¤–é€è²»:'),
                        React.createElement('span', null, `$${deliveryFee}`)
                    ),
                    React.createElement('div', { className: 'flex justify-between font-bold text-lg text-gray-800 border-t border-gray-300 pt-3 mt-3' },
                        React.createElement('span', null, 'ç¸½é‡‘é¡:'),
                        React.createElement('span', null, `$${totalAmount}`)
                    )
                ),
                
                // æäº¤æŒ‰éˆ•
                React.createElement('div', { className: 'mt-6' },
                    React.createElement('button', {
                        onClick: handleSubmit,
                        disabled: cart.length === 0 || isLoading,
                        className: 'w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center clickable-btn'
                    },
                        isLoading ? [
                            React.createElement(LoadingSpinner, { key: 'spinner' }),
                            React.createElement('span', { key: 'text' }, 'è™•ç†ä¸­...')
                        ] : 'âœ… é€å‡ºè¨‚å–®'
                    )
                )
            );
        };

        // ä¸»æ‡‰ç”¨çµ„ä»¶
        const App = () => {
            return React.createElement('div', { className: 'p-4 min-h-screen flex items-center justify-center' },
                React.createElement('div', { className: 'container max-w-md mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden' },
                    React.createElement('div', { className: 'bg-[#fff3cd] border border-[#ffeaa7] rounded-t-2xl p-2.5 text-xs text-center text-[#856404]' },
                        'ğŸ”’ å®‰å…¨è¨‚é¤ç³»çµ± - 24å°æ™‚æ¥å—é è¨‚'
                    ),

                    React.createElement('header', { className: 'bg-green-500 text-white p-5 text-center' },
                        React.createElement('h1', { className: 'text-2xl font-bold mb-1' }, 'ğŸœ å°ç£å°åƒåº—'),
                        React.createElement('p', { className: 'text-sm opacity-90' }, 'LINE å¿«é€Ÿè¨‚é¤ - 24å°æ™‚æœå‹™')
                    ),

                    React.createElement('main', { className: 'p-5' },
                        React.createElement(OrderPage)
                    ),
                    
                    React.createElement('footer', { className: 'bg-gray-100 p-4 text-center text-xs text-gray-500 border-t border-gray-200' },
                        React.createElement('p', null, 'ğŸ“ ç‡Ÿæ¥­æ™‚é–“: 10:00 - 21:00 | ğŸ“ è¯çµ¡é›»è©±: 02-1234-5678')
                    )
                )
            );
        };

        // æ¸²æŸ“æ‡‰ç”¨
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
